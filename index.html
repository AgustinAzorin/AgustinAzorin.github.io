<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tarjeta para Mel</title>
  <meta name="description" content="Tarjeta de cumpleaÃ±os virtual" />
  <style>
    :root{
      --bg: #0b0d10;
      --fg: #e8eef5;
      --muted:#9aa6b2;
      --accent:#8b5cf6;
      --paper:#11141a;
      --paper-in:#0f1724;
      --shadow: rgba(0,0,0,.35);
    }
    html.light{
      --bg:#f6f7fb;
      --fg:#0f172a;
      --muted:#5b6470;
      --accent:#7c3aed;
      --paper:#ffffff;
      --paper-in:#f8fafc;
      --shadow: rgba(0,0,0,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 800px at 50% -10%, rgba(139,92,246,.15), transparent 60%), var(--bg);
      color: var(--fg); min-height:100svh; display:flex; align-items:center; justify-content:center;
    }
    .app{width:min(1100px, 100%); padding:24px}
    .topbar{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px}
    .topbar h1{font-size:16px; font-weight:600; letter-spacing:.3px; margin:0; color:var(--muted)}
    .btn{
      appearance:none; border:0; border-radius:14px; padding:10px 14px; font-weight:600; cursor:pointer;
      background:var(--paper); color:var(--fg); box-shadow: 0 6px 16px var(--shadow); transition:.2s transform,.2s filter,.2s background;
    }
    .btn:hover{transform:translateY(-1px)}

    /* Escena y tarjeta */
    .scene{perspective: 1400px; display:grid; place-items:center}
    .greeting-card{
      width:min(940px, 96%); height: clamp(460px, 62svh, 580px);
      position:relative; transform-style: preserve-3d;
    }
    .cover, .inside{
      position:absolute; inset:0; border-radius:22px; box-shadow: 0 24px 60px var(--shadow);
      backface-visibility: hidden;
    }

    .cover{
      z-index:2;
      background:
        radial-gradient(900px 500px at 10% -20%, rgba(139,92,246,.25), transparent 60%),
        linear-gradient(165deg, #0b1020, var(--paper));
      transform-origin: left center;
      transform: rotateY(0deg);
      transition: transform 900ms cubic-bezier(.22,1,.36,1);
      display:flex; align-items:center; justify-content:center; padding:24px; cursor:pointer;
    }
    .cover h2{font-size: clamp(28px, 5vw, 46px); margin:0}
    .cover p{margin:6px 0 0; color:#d6d9e0}

    .inside{
      z-index:1;
      background: linear-gradient(180deg, var(--paper-in), var(--paper));
      padding:24px; display:flex; flex-direction:column; justify-content:space-between;
    }

    /* Layout interior: mensaje a la izquierda + galerÃ­a a la derecha */
    .inner{display:grid; grid-template-columns: 1.2fr 1fr; gap:22px; height:100%}
    @media (max-width: 860px){ .inner{grid-template-columns: 1fr; } }

    .message{
      background:rgba(0,0,0,.05); border:1px solid rgba(255,255,255,.06); border-radius:18px; padding:18px;
      overflow:auto;
    }
    html.light .message{background:rgba(0,0,0,.03); border:1px solid rgba(0,0,0,.06)}
    .message h3{margin:0 0 8px; font-size: clamp(20px, 3.4vw, 26px)}
    .message p{margin:0; line-height:1.6; color:var(--fg)}

    /* GalerÃ­a */
    .gallery{border-radius:18px; overflow:hidden; background:rgba(0,0,0,.06); display:grid; grid-template-rows: 1fr auto;}
    .viewport{position:relative; overflow:hidden}
    .strip{display:flex; transition: transform .45s ease}
    .slide{flex:0 0 100%; display:grid; place-items:center; height:100%}
    .slide img{width:100%; height:100%; object-fit:cover}
    .text-slide{display:grid; place-items:center; padding:24px; text-align:center}
    .text-slide h4{font-size: clamp(22px, 4.5vw, 34px); margin:0}
    .controls{display:flex; gap:8px; padding:10px; align-items:center; justify-content:space-between; background:rgba(0,0,0,.06)}
    .pills{display:flex; gap:6px}
    .pill{width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,.25)}
    html.light .pill{background:rgba(0,0,0,.2)}
    .pill.active{background:var(--accent)}
    .arrow{border:0; background:transparent; color:var(--fg); font-size:20px; cursor:pointer; padding:6px 8px}

    .credits{font-size:12px; color:var(--muted); text-align:center; margin-top:14px}

    .open .cover{transform: rotateY(-178deg)}
    .open .cover:after{content:""; position:absolute; inset:0; border-radius:22px; background:linear-gradient(90deg, rgba(0,0,0,.0), rgba(0,0,0,.35));}

    /* Confetti */
    .confetti{position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:9999}
    .piece{
      position:absolute; width:8px; height:12px; border-radius:2px; opacity:.95;
      animation: fall linear forwards;
    }
    @keyframes fall{ to {transform: translateY(110vh) rotate(720deg)} }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <h1>ðŸŽ‚ Tarjeta</h1>
      <button class="btn" id="toggleThemeBtn" title="Cambiar tema">ðŸŒ“ Tema</button>
    </div>

    <div class="scene">
      <div class="greeting-card" id="card">
        <div class="cover" id="cover" role="button" aria-label="Abrir tarjeta" tabindex="0">
          <div class="cover-content" style="text-align:center">
            <h2>Para Mel ðŸ’œ</h2>
            <p>TocÃ¡ para abrir</p>
          </div>
        </div>

        <div class="inside">
          <div class="inner">
            <section class="message" aria-live="polite">
              <h3>Â¡Feliz cumple, Mel! ðŸŽ‰</h3>
              <p id="customText">
                Deseo que este aÃ±o te traiga proyectos lindos, risas hasta tarde y muchos mates compartidos.
                Gracias por estar siempre. ðŸ’«
              </p>
            </section>

            <section class="gallery">
              <div class="viewport">
                <div class="strip" id="strip"></div>
              </div>
              <div class="controls">
                <button class="arrow" id="prev" aria-label="Anterior">â—€</button>
                <div class="pills" id="pills"></div>
                <button class="arrow" id="next" aria-label="Siguiente">â–¶</button>
              </div>
            </section>
          </div>
          <div class="credits">Hecho con â™¥ â€” <span id="year"></span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <script>
    const root = document.documentElement;
    const savedTheme = localStorage.getItem("theme");
    if(savedTheme === "light") root.classList.add("light");

    document.getElementById("toggleThemeBtn").onclick = () => {
      const isLight = root.classList.toggle("light");
      localStorage.setItem("theme", isLight ? "light" : "dark");
    };

    const card  = document.getElementById("card");
    const cover = document.getElementById("cover");
    const confettiLayer = document.getElementById("confetti");

    function launchConfetti(){
      const count = 80;
      confettiLayer.innerHTML = "";
      for(let i=0;i<count;i++){
        const el = document.createElement("div");
        el.className = "piece";
        const left = Math.random()*100;
        const delay = Math.random()*0.8;
        const dur = 1.6 + Math.random()*1.2;
        const w = 6 + Math.random()*8;
        const h = 8 + Math.random()*14;
        el.style.left = left + "vw";
        el.style.top = "-10vh";
        el.style.width = w+"px";
        el.style.height = h+"px";
        el.style.background = `hsl(${Math.random()*360}, 80%, 60%)`;
        el.style.animationDuration = dur+"s";
        el.style.animationDelay = delay+"s";
        confettiLayer.appendChild(el);
        setTimeout(()=> el.remove(), (delay+dur)*1000 + 500);
      }
    }

    function toggleCard(){
      const isOpen = card.classList.toggle("open");
      if(isOpen) launchConfetti();
    }
    cover.addEventListener("click", toggleCard);
    cover.addEventListener("keydown", (e)=>{ if(e.key==="Enter" || e.key===" "){ e.preventDefault(); toggleCard(); } });

    document.getElementById("year").textContent = new Date().getFullYear();

    // ===== GalerÃ­a (usa ./src/) =====
    const IMAGES = ["foto1.jpg","foto2.jpg","foto3.jpg"]; // coloca tus archivos en ./src/
    const IMAGE_PATH = "./src/";

    // Sorpresa segura (texto + imagen final)
    const SURPRISE_ENABLED = true;
    const SURPRISE_TEXT = "Y ahora la foto que mÃ¡s te va a gustar ðŸ˜Š"; // texto grande
    const SURPRISE_IMAGE = "sorpresa.jpg"; // ponÃ© aquÃ­ una imagen linda/segura en ./src/

    const strip = document.getElementById("strip");
    const pills = document.getElementById("pills");
    const btnPrev = document.getElementById("prev");
    const btnNext = document.getElementById("next");

    let idx = 0;

    function renderGallery(){
      strip.innerHTML = "";
      pills.innerHTML = "";

      // Si no hay imÃ¡genes, mostrar placeholder y salir
      if(IMAGES.length === 0 && !SURPRISE_ENABLED){
        const placeholder = document.createElement('div');
        placeholder.className = 'text-slide slide';
        placeholder.innerHTML = '<h4>SubÃ­ tus fotos a ./src/ para ver la galerÃ­a</h4>';
        strip.appendChild(placeholder);
        btnPrev.disabled = true; btnNext.disabled = true;
        return;
      }

      const total = IMAGES.length + (SURPRISE_ENABLED ? 2 : 0);

      for(let i=0; i<total; i++){
        if(SURPRISE_ENABLED && i === IMAGES.length){
          // Slide de texto
          const s = document.createElement('div');
          s.className = 'text-slide slide';
          s.innerHTML = `<h4>${SURPRISE_TEXT}</h4>`;
          strip.appendChild(s);
        } else if(SURPRISE_ENABLED && i === IMAGES.length + 1){
          // Slide de imagen sorpresa
          const s = document.createElement('div');
          s.className = 'slide';
          const img = document.createElement('img');
          img.src = IMAGE_PATH + SURPRISE_IMAGE;
          img.alt = 'Sorpresa';
          s.appendChild(img);
          strip.appendChild(s);
        } else {
          // Slides de fotos normales
          const s = document.createElement('div');
          s.className = 'slide';
          const img = document.createElement('img');
          img.src = IMAGE_PATH + IMAGES[i];
          img.alt = `Foto ${i+1}`;
          s.appendChild(img);
          strip.appendChild(s);
        }
      }

      // PÃ­ldoras de navegaciÃ³n
      for(let i=0;i<total;i++){
        const dot = document.createElement('div');
        dot.className = 'pill' + (i===idx ? ' active' : '');
        dot.onclick = ()=> goTo(i);
        pills.appendChild(dot);
      }

      updatePos();
    }

    function updatePos(){
      const slides = strip.children.length;
      if(slides===0){ return; }
      idx = (idx + slides) % slides; // seguridad
      strip.style.transform = `translateX(-${idx*100}%)`;
      [...pills.children].forEach((d, i)=> d.classList.toggle("active", i===idx));
    }

    function goTo(i){ idx = i; updatePos(); }

    btnPrev.onclick = ()=> { idx--; updatePos(); };
    btnNext.onclick = ()=> { idx++; updatePos(); };

    renderGallery();
  </script>
</body>
</html>
